#Footprint & Scanning
Active Information Gathering
・ペネトレショーンテストの方法論
1) 情報収集
　① 受動的な情報収集：OSINT
　② 積極的な情報収集：ネットワークマッピング、ホスト発見、ポートスキャン、サービス検知&OS、検知

2) 列挙
　① サービスの列挙
　② ユーザー列挙
　③ 共有列挙

3) 悪用/侵入
　① 脆弱性の分析と脅威モデル：脆弱性の分析、脆弱性、識別
　② 侵入：開発/修正、侵入、サービス侵入

4) 侵入後の活動
　① ローカル列挙
　② 権限昇格
　③ 認証情報の取得
　④ 永続化
　⑤ 防御回避
　⑥ 横展開

5) 報告
　① レポート作成

quiz
・偵察段階におけるFootprintの焦点は、標的ネットワークとシステムに関する詳細な情報収集
・公開されている情報源から情報収集する偵察の種類は受動偵察

・ネットワークの基礎
コンピュータネットワークでは、ホストはネットワークプロトコルを通して互いに意思疎通をしている。
→ネットワークプロトコルが異なるコンピュータシステムが意思疎通できるようにしている。
→異なる機能や目的で使用されるネットワークプロトコルは多くある
→プロトコルを通して意思疎通は、パケットの使用によって行う。

ネットワーキングの目的は、相互間の情報交換
→パケットの移動は、電気信号である。
→電気信号は、情報を補うビットとして解釈される

全てのパケットは、「Header+Payload」という構造でできている。
→Header：制御情報
→Payload：データ（メールの本文など）

OSIモデル
→これは、コンピュータが通信をする機能を標準化したもので７つの層から構成される。
物理→データリンク→トランスポート→ネットワーク→セッション→プレゼンテーション→アプリケーション

quiz
OSIモデルにおけるネットワーク層の役割は、論理アドレスの指定とルーティング
OSIモデルで、エンドツーエンドの通信やフロー制御、エラー訂正をしているのは、トランスポート層
OSIモデルで、暗号化や圧縮などのアプリケーション層と下層の間のデータ変換を行うのは、プレゼンテーション層

ネットワーク層
→デバイス間の論理アドレスの指定、ルーティング、データパケット転送
→主目的は、デバイス間が異なるネットワーク間であっても情報源から目的地までのデータ転送を最適なパスを決定すること
→物理ネットワークを抽象化し、まとまりのあるインターネットワークの作成を行う。
→主要なプロトコル
　1) IP
　　・IPv4：最も広く使われるIPのバージョン
　　　　　　 32bitのアドレスで、インターネット上のコミュニュケーションの基盤
　　・IPv6：IPv4の制限に対処するために開発された
　　　　　　 128bitのアドレスで、指数関数的に大きなアドレス空間を提供する。

 2) ICMP
　　・エラー報告と診断に使用される。
　　・ICMPのメッセージには、pingとtracerouteおよびさまざまなエラーメッセージが含まれる。
→IPは、論理アドレスの指定、ルーティングや断片化、データパケットの再組み立て、サブネット化を担当する。
→ネットワーク層は、異なるネットワーク間のホスト間でも通信できるようにする。
→DHCPは、IPと組み合わせて使用されることが多く、ネットワーク上にIPアドレスを動的に割り当て、ネットワークの構成を簡素化する

IPヘッダーのフォーマット
・IPプロトコルは、パケットヘッダーにさまざまなフィールドを定義する
・そしてこれらのフィールドには、パケットを転送する際に参照するバイナリ値が含まれる
・IPヘッダーに含まれるものは以下のものである。
　1) IPの送信元のアドレス：パケットの送信先
　2) IPの送信先のアドレス：パケットの目的地
　3) Time-to-Live(TTL)：パケットの存続時間を8ビットで表現
　4) Type-of-Service(ToS)：パケットの優先度を決定するために使用される8bitのフィールド
　5) Protocol：パケットが運んでいるデータのペイロードを指し示す8ビット
quiz
・ネットワーク層で動作し、インターネット上の論理アドレス指定とルーティングによく使用されるプロトコルはIP
・ネットワーク層のIPヘッダーにあるTTLのフィールド目的はパケットがネットワーク上で通過できるホップ数の制限する

トランスポート
・OSIモデルで第4層に位置する。
・この層は、ネットワークで区切られた二つのデバイス間でのコミュニケーションを促進する。
・この層では、エラー訂正,流れの制御,データのセグメントを小さいユニットに分解する
・この層は、end-to-endでの通信を可能にし、信頼性やデータの配送を保証する

・この層では、以下の二つのプロトコルが使用される
1) TCP
・接続指向のプロトコル
→受信する側と送信する側で承認し合う。場合によっては、認証が必要
・信頼性とデータの順序性をを提供する
・損失や破損したパケットを再送信する
・データが正しい順序で送信される
・TCPはポート番号でアプリケーションを区別する
・TCP 3way-handshake(TCP確立）
client→syn→server
client←syn-ack←server
client→ack→server
・TCPはポート番号を使用して異なるサービスとデバイスのアプリケーションを区別する
・ポート番号は、16bitで３つの範囲に分けられる
・TCP/IPプロトコルスイートの最大の番号は、65535
・ポート番号が予約されているもの
1) 80：http
2) 443：https
3) 21：ftp
4) 22：ssh
5) 25：smtp
6) 110：pop3

2) UDP
・コネクションレス型のプロトコル
・高速だが、データ配送の順序に関する信頼性などの保証はない
・ネットワークのデバイス間にデータを伝えるために簡単で最小な方法で提供する
・そのため、データの保証や通信の信頼性は低い。
・しかし、アプリケーションに適した方法で行い、効率性や簡素化に焦点を当てている
・コネクションレスのため、それぞれのパケットは独立的に扱われ、デバイス間での永続的な持続性はない。
・信頼性やデータの保証はせずに再送信の機能もない。そのため、データの到達を要求するアプリケーションは向かない
・UDPの使用例
1) リアルタイムアプリケーション：オーディオ、ビデオストリーミング、オンラインゲーム、
2) IPまたはVoIP通信：シーケンスなどの通信に関する状態や情報を維持しない

・wireshark
→ネットワークの解析ツール
→できること
1) 

quiz
UDPの役割は、コネクトレスで高速な通信
TCPシェイクハンドでのパケットでの交換回数は3回

ホストの検出
ネットワークマッピング
・受動的な情報種集の間ターゲット組織の情報を収集した後はペンテスターはホスト検出を含む積極的な情報収集に移る。
→ネットワーク上では、ポートやスキャン、列挙に実行する
・インターネットやプライベートのネットワークに接続されたすべてのホストは、一意のIPアドレスを持たなければいけない

・ペンテスにおけるネットワークマッピングは、対象となるホストやデバイスそしてネットワークインフラストラクチャー要素を検出して識別するプロセス
・ペンテスターは、情報収集の重要な最初のステップとしてネットワークマッピングを使用する
→目的は、ネットワークのレイアウト、構造の理解、さらなる侵入のためのエントリポイントの特定

・ネットワークマッピングの目的
1) 生きているホストの発見
・ネットワーク上でアクティブなホストやデバイスの特定
2) 空いているポートやサービスの特定
・発見されたホストの空いているポートやそれらの走っているサービスの特定
・ここでの情報は、ペンテスターが表面の攻撃や脆弱性の理解につながる
3) ネットワークトポロジー
・ネットワークトポロジーのルート、スイッチ、ファイアウォールや他のネットワークインフラストラクチャーの要素を含むマップやダイアグラムの作成
・ネットワークレイアウトの理解は、さらなる侵入テスト活動での計画を支援する
4) OSのフィンガープリント
・検出されたホストで実行されているOSの決定
・OSを知ることによってペンテスでは、OS固有の脆弱性を狙った攻撃戦略をカスタマイズできる
5) サービスバージョンの検知
・空いているポート上で走っているサービスの特定のバージョンをする。
・この情報は、特定サービスのバージョンに関連されるピンポイントの脆弱性に有効である
6) フィルターやセキュリティ測定の特定
・ファイアウォール、侵入防止システムやセキュリティ測定の検出
・これはペンテスのネットワーク防御の理解やそれに応じたアプローチ計画を助ける

・nmapやnetworkmapperはコンピュータネットワーク上のサービスやホストの検出に使用されるオープンソースのネットワークスキャンを行う
→空いているポートの発見や脆弱性の特定
→これは、強力で多用途に使用できる標準的なツールキットでセキュリティのプロやネットワークの管理者、ペンテスターなどが使用する
・nmapの機能
1) ホスト検出
・nmapはネットワーク上で使用している技術で生きているホストの特定
・例えば、ICMPのエコー要求、arp要求、TCP・UDPの探索
2) ポートスキャン
・ターゲットホストの空いているポートを検出するためにはさまざまなポートタイプに対応するポートスキャンを行う
3) サービスバージョンの検知
・nmapは、空いているポートで動いているサービスのバージョンを決める
・この情報は、ソフトウェアのスタックや特定のバージョンで関連づけられる潜在的な脆弱性の理解を助ける
4) OSのフィンガープリント
・nmapはスキャンの過程で観察された特徴に基づいたターゲットpホストのOSの検出を試みることができる

quiz
ペンテスにおける偵察フェーズでのネットワークマッピングの重要性は、ターゲットネットワークの構造のblueprintを提供する

・ペンテスにおいて、ホスト検出はさらなる侵入や脆弱性の調査の前に生きているホストを特定するために重要な段階
→様々な技術がホスト検出で使用され、技術の選択はネットワークの特徴、ステルス要件そして、ペンテスの目的などの要因に依存する

・ホスト検出の技術
1) Ping Sweeps(ICMP Echo Requests)
・ICMP要求パケットを生きているホストを検出するためにIPアドレスの範囲に送る
・これは高速にそして一般的に使用される
2) ARP Scanning 
・ローカルネットワーク上のホストの特定のためにARP要求を使用する
・ARP Scanは、同じブロードキャストドメインの範囲内でホストの検出において効率的
3) TCP SYN-ping
・ホストが生きているかを確認するためにTCP SYNパケットを特定のポートに送る
・もしホストが生きている場合には、TCP SYN-ACKで反応する。
・この技術は、ICMPよりもステルス性が高い
4) UDP Ping
・ホストが生きているかを確認するために特定のポートであるUDPパケットを送る
・これは、ICMPやTCP探索に反応しないホストには効率的にである
5) TCP ACK Ping
・ホストが生きているかを確認するために特定のポートにTCP ACKパケットを送る
・この技術は応答を期待しないがもしTCPreset(RST)を受け取ったならば、それは、ホストが生きていることをさす
6) SYN-ACK Ping
・ホストが生きているかを確認するための特定のポートも対してTCP AYB-ACKパケットを送る
・もしTCP RSTを受けっとったならばホストが生きていていることを指す

・ホスト検出の技術の効果は、ターゲットネットワークの特定の特徴に影響を受ける
→その要因は、セキュリティ管理とペンテスの目標である

・この技術の考慮すべき点
1) ICMP
メリット：ICMP Pingは生きているホストを特定するために広く支援されて、高速な方法で行う。
デメリット：いくつかのホストあるいは、ファイアウォールはICMPトラフィックをブラックアウトするように設定されており、その効果を制限する
　　　　　　ICMP Pingは容易に検出される

2) TCP SYN Ping
メリット：TCP SYN Ping はICMPよりステルスでアウトバンド接続を許可するファイアウォールをバイパスするかもしれない
デメリット：いくつかのホストは、TCP SYN要求は反応しないかもしれないそして、その結果はファイアウォールとセキュリティデバイスによって影響される

quiz
潜在的なホストにICMPエコー要求パケットを送信し、その応答を分析するホスト検出手法は、ping sweeping

Ping sweeps
・Ping sweepは、ネットワーク上で特定の範囲にあるIPアドレスを使って生きているホスト（コンピュータ、サーバー、他のデバイス）を検出するために使用される
・これの基本的な考え方は、ICMP要求メッセージの連続をIPアドレスの範囲に送り、アドレスがアクティブあるいは到達可能かどうかを決定するための反応を観察する
・このコマンドは、ホストが生きているか到達可能かどうかの調査するためにデザインされるユーティリティである。
・ping コマンドはすべてのOS上で利用可能で、ターミナルやコマンドラインで使用される
・ping sweepは、特別に細工された1つ以上のICMPパケットをホストに送信することで機能する
　ホストがICMP echo応答でパケットで応答した場合はホストは稼働中/オンライン
　ICMPの文脈では、ICMP要求エコーやICMP応答メッセージは、pingの目的で使用される。
　これらのメッセージは特定のicmpタイプやそれらに関係するコード値を取る
・ICMP要求を送るときに示し、
+type:8
+code:0
　ICMP応答受け取った時に反応として返す
+type:0
+code:0

・ICMPのヘッダーのタイプの種類は、ICMPのメッセージの目的や機能を示し、コードのフィールドは追加の情報やメッセージタイプに関連する文脈を提供する
・ホストがオフラインで到達不可能なとき、pingユーティリティによって送られたICMP要求メッセージは、通信しているICMP応答を受け取らない。
・応答がないことは、ホストが一時的にオフラインであること必ずしも意味をするわけではない
→応答がない理由としては、ネットワークの混雑、一時的な不可能あるいはICMPトラフィックをブロックするファイアウォールの設定
・pingのユーティリティは、ホストの到達性を確認するために高速で簡単に方法を提供するがネットワークの状況やホストの構成を考慮して結果を解釈する

・ping IPアドレスでできることは以下
1) ホストの稼働確認
2) 相手までにルーティングがあるか
3) 遅延時間（ラウンドトリップタイム）
4) パケットロス率
→ping -c 回数　IPアドレス：パケットの行き来の回数を指定できる
→ping -b IPアドレス：ブロードキャストでpingを送るオプション
→ping -b -c -N IPアドレス：指定したブロードキャストIPアドレスに向けて、N回だけブロードキャストpingを送信する

・fping　IPアドレス：高速で大量のホストにpingコマンドを送れる
特徴
1) 複数のターゲットを一気にチェック可能
2) 高速
3) スクリプト向き

quiz
pingスイープにおいて、ICMPパケットのTTL値を調整する目的は、ホップ数を制限する。

nmapによるホスト検出
・ここでの目的は、N-Mapを使用して次のことを行う方法を示すことで、ホストが稼働しているかどうかを最終的に判断し、ほぼ稼働状態に近づけます。
スキャン結果の精度は100%
・pimg IPアドレス
役割：ネットワーク疎通確認用ツール
仕組み：ICMPのEcho要求(tyoe8)を送信し、相手からEcho応答(type0)が返ってくるかを確認する。

・wireshark
機能：wiresharkが持っているパケット解析
具体的にできることは以下のもの：
1) レイヤごとの分解表示
2) プロトコルの解釈
3) フィルタリング
4) 統計情報

・nmap
機能：ポートスキャンやOS判定、サービス検出などを行うセキュリティツール
-sn：ホスト検出のみ（ポートスキャンは行わずに「ホストが生きているか」だけを調べる
コマンド：nmap  -Pn IPアドレス：対象ホストをpingで確認せずに、そのままポートスキャンを行う
1) ホスト発見をスキップできる
2) ファイアウォールでICMPがブロックされていても調査可能
3) 無駄にスキャンする可能性がある。
コマンド：nmap -sn IPアドレス：そのホストが生きているかどうかを調べるモード（ポートスキャンは行わない）
コマンド：nmap -sn iL textfile：textfileに書かれたターゲット一覧を1行ずつ読み込んで実行する
コマンド：nmap -s -PS IPアドレス：ポートスキャンは行わずに指定のTCPポートへSYNを送り、応答があればホストをupと判定する
→-PS：TCP SYNプロープを送ってホストを反応するかを見る。つまり、指定ポートに対してSYNを送る
コマンド：nmap -sn -PA IPアドレス：ポートスキャンを行わずに指定したTCPポートへACKを送ってホストが生存しているかを判定する
→-PA：TCPのACKパケットを指定ポート位送って応答があるかを見る
コマンド：nmap -sn -PE IPアドレス：そのIPにICMP要求を送り、応答があればホストをupと判定する
→-PE：ICMPエコー要求を送って応答が返ってくるかでホストの到達性を判断する
コマンド：nmap -sn -v -T4 IPアドレス：指定したホスト/ネットワークの生存確認を速く行う
→-v：冗長出力を行い、スキャン進行や理由（成功/失敗のログ）が詳しく出る
→-PU：UDP pingを使ったホスト検出を行う。

quiz
・nmapのホスト検出スキャンにおける「-PE」オプションの目的は、ICMPエコー要求を使用してping sweepを実行すること
・ホスト検出に一般的に使用され、ホストのステータスを判断するためにICMPエコー要求パケットを送信するnmapのオプションは、-sn

タスク
N-mapを使用して利用可能な生きているホストとその開いているポートを検出し、実行中のサービスとアプリケーションを識別する。
解答)
1) kaliマシンにアクセスする。
2) ターゲットマシンにpingを実行して、稼働中かどうかを確認する。
コマンド：ping -c ドメイン名
3) ターゲットに対してNmapスキャンを実行する。
コマンド：nmap　ドメイン名
4) -Pnオプションを使用してNmapを実行し、すべてのアクティブなポートを検出する。
コマンド：namp -Pn ドメイン名
→ターゲットマシン上で開いているポートとそうでないものを区別する。
5) オプション-sVを使用して、指定したポート番号で実行中のアプリケーションを検出する
コマンド：nmap -Pn -sV -p ポート番号 ドメイン名

nmapを使ったポートスキャン
・侵入テストでは、ポートスキャンから始める

・コマンド：nmap -Pn IPアドレス
→
・コマンド：nmap -Pn -F IPアドレス
→
・コマンド：nmap -Pn -p ポート番号　IPアドレス
→
・コマンド：nmap -T4 -Pn -p- IPアドレス
→
・SYNステルススキャンについて
→
・nmap -Pn -sT IPアドレス


サービスバージョンとOSの検知
・nmap -sS IPアドレス
→-sS：ステルススキャンを実行 
・nmap -T4 -sS -sV -p- IPアドレス
→開いているポート番号、サービス、バージョンとOSが特定できる
・nmap -T4 -sS -sV -O -p- IPアドレス
・nmap -T4 -sS -sV -O --osscan-guess -p- IPアドレス
・nmap -T4 -sS -sV 　--version-intensity 検出レベル(0~9) -O --osscan-guess -p- IPアドレス

quiz 
・nmapでは、サービス検出において「--version-intensity」オプションはサービスバージョン検出の積極性を制御する。

nmap script engine（サービスのバージョン検出とOSの検出を行う）
・ifconfig
1) 役割
　　ネットワークインターフェースの設定や状態確認をするコマンド
2) 用途
　　IPアドレスやMACアドレスの表示
　　ネットワークインターフェースの有効化/無効化
　　ネットマスク、ブロードキャストアドレスの設定
　　パケット送受信状況の確認
・ls -al /usr/share/nmap/scripts/
・ls -al /usr/share/nmap/scripts/ | grep -e "http"
・nmap -sS -sV -sC -p- -T4 IPアドレス

・ls -al /usr/share/nmap/scripts/ | grep -e "memcached"
・nmap --script-help=memcached-info
・nmap -sS -sV --script=memcached-info -p- -T4 IPアドレス
・ls -al /usr/share/nmap/scripts/ | grep -e "ftp"

quiz 
・nmapスクリプトエンジンを使用する時にスクリプトカテゴリを指定するのは、--script=カテゴリ

quiz
・ターゲットホスト上の開いているUDPポートを識別するためにUDPポートスキャンを実行するためのオプションは、-sU
・Nmapのポートスキャンで「-p-」オプションを使用する意味は、すべてのTCPポートをスキャンする

タスク：nmapを使用して対象ネットワーク上の開いているポートとサービスをスキャン・検出する
1) kaliLinuxを起動
2) 以下のコマンドでターゲットマシンにアクセスできるかを確認
nmap -c 回数　ターゲットドメイン
3) nmapでポートスキャンを行い、ターゲットシステム上の開いているポートを識別する。コマンドは以下のを使用
nmap ドメイン名
4) もし上記でターゲットの開いているポートを見つけられない場合は、以下のコマンドでTCPポート範囲全体をスキャンする
nmap ドメイン名 -p-
5) 3)や4)で見つけたポートを使って、nmapを使用してサービス検出のスキャンを実行する。実行するコマンドは以下
nmap ドメイン名　-p ポート番号　-sV

タスク：nmapを使用して、ポートスキャンとサービスを検出を実行するプロセス
1) kaliLinuxを起動
2) 以下のコマンドで、ターゲットマシンにアクセスできるかを確認する。
ping -c 4 ターゲットドメイン
3) 以下のコマンドで、ターゲットシステムでnmapポートスキャンを実行し、BIND DNSサーバーが開いているかを確認する
nmap ターゲットドメイン　-p 177 -A
*-A：アグレッシブスキャンの指定を行う。
4) 以下のコマンドを使用して、ポート範囲1~250でUDPポートスキャンを実行する。
nmap ドメイン名 -p 1-250 -sU
*-sU：UDPスキャンを行うスキャン
5) 4)で特定したポートを指定して、nmapによりサービスの検出スキャンを実行、その後、開いているポートで実行されているサービスの特定
nmap ドメイン名 -p ポート番号 -sUV
*-sUV：
6) 以下のコマンドを使って、知りたいポート番号の詳細な情報を見ることができる。
nmap ドメイン名 -p ポート番号 -sUV --script=discovery
7) tftp ドメイン名 ポート番号

タスク：nmapを使用して、ポートスキャンとサービスの検出を行う
1) kaliマシンにアクセス
2) 以下のコマンドでターゲットマシンにアクセスする。
ping -c 回数 ドメイン名
3) 以下のコマンドでTCP範囲全体に対してnmapポートスキャンを実行して、対象のシステムで開いているポートを特定する
nmap ドメイン名 -T4 -p-
4) 以下のコマンドでUDPポートスキャンを実行して、ターゲットシステムで開いているUDPポートを検出する。
nmap ドメイン名 -T4 -sU
5) 以下のコマンドを使用して前のフェーズで特定したUDPポートで実行されているサービスについて詳しく知る
nmap ドメイン名 -T4 -sU -p ポート番号 -A


ファイアウォールの検知とIDSまたは侵入検出システムの回避
・ここでは、nmapを使用してホストベースのファイアウォールの存在を検出する方法またはフィルタリングメカニズムの存在

・nmap -Pn -sS -F ターゲットIPアドレス：ファイアウォールまたはホストとの間のフィルタリングがあるかどうかを判断する方法
→ホスト検出を無効にして、SYNスキャンを行う
→-F：高速スキャン
・nmap -Pn -sA -pポート番号　IPアドレス：指定したポートのサービスとフィルターがかかっているかを調べられる。

・nmap -Pn -sS -sV -F -f IPアドレス：
→ホスト検出を無効いして、SINスキャンとサービスバージョンを検出スキャンを行い、高速スキャンを使用する、パケットをフラグメント化するために

・nmap -Pn -sS -sV -p ポート番号 -f --data-lemgth 200 -D Gateway アドレス
・nmap -Pn -sS -sV -p ポート番号 -f --data-length 200 -g ポート番号 -D IPアドレス

quiz
大きなパケットを小さなフラグメントに分割してファイアウォールを回避するために特別に設計されたnmapオプションは、-f

nmapスキャンの最適化（低速化や高速化）
・スキャンを遅くしたい理由は以下の2つである。
1) スキャンを遅くすることによりパケットの量を減らすことができる。
2) ネットワーク活動の不審さが軽減される。

・送信するトラフィック量を増やすと意図しないサービス拒否が発生したり、スイッチやルーターに障害が発生する可能性という問題が発生する。

・nmap -Pn -sS -F --host-timeout 時間 ゲートウェイアドレス
・nmap -sS -sV -F ゲートウェイアドレス

・nmap -sS -sV -F --scan-delay 時間 ゲートウェイアドレス
・nmap -sS -sV -F -T1 ゲートウェイアドレス

nmapの出力形式
・重要なことは、スキャン結果を確実に保存したりメモしたりすること。

・ペンテスを実行するときは、実行したすべてのことを必ずログを記録し、保存する。
→理由としては
1) どのようなオプションを選択したのかについての説明責任を負う必要があるため
2) 目的に対してどのようなアクションを実行したかを説明するため

・結果の保存も重要である（スキャンは特定のファイルに保存）。
理由としては、大規模なスキャンを行った時に、数百のIPをスキャンしたときに、結果を保存せずに端末をshut downすると再度スキャンが必要になる。

・ここでの目的は、Nからスキャン結果を出力する方法を示すこと

・nmapの優れた点の1つは、スキャンの出力を保存し、その結果を選択した出力形式に変換できる。

・出力では、オプションによって保存形式が決まる。
-oN：txtファイル
-oX：XML形式
→これは、変換レイヤーを提供するのに優れている
→xmlに変換し、それらの結果をmetasploitにインポートする
-oS：script kiddkie形式を使用して、保存する。
-oG：グリップ可能なフォーマットである
→スキャン結果を把握可能な形式で出力する。その後の、クエリや解釈、そのほかのほとんどのことを行うことができる。
→結果のクリーンアップや特定の方法で結果を表示できるようにする。
＊クエリ：

・-oAオプションは、スキャン結果をすべてのデータに結合または出力できる

・以下のコマンドでポートスキャンを実行できる
→nmap -Pn -sS -F -T4 ターゲットIP -oN nmap テキストファイル

・service postgresql start
　　　　　　　　↓
　        msfconsole

*msfconsole：
→ここでは、workspaceがlsの代わり？

・egrepは、何を表示するかを示すコマンド

quiz
sedやawkなどのツールを使用してテキストを素早く解析するのに最適なnmap出力形式は、-oG

task：サービスのフィンガープリントを作成し、nmapスクリプトを実行してwindowsターゲットマシンのsmbサービスを列挙する
1) kaliLinuxにアクセスする
2) ターゲットマシンにpingを実行して、稼働中かを確認
3) ターゲットに対してnmapスキャンを実行する。
→ここで空いているポート確認する
4) nmapスクリプトを実行して、smbサーバでサポートされているプロトコルとdialectを一覧表示する。
nmap -pポート番号 --script 対象のプロトコル名-protocols ドメイン名
5) セキュリティモードスクリプトを実行して、smbセキュリティに関する情報を返す
nmap -p445 --script smb-security-mode ドメイン名
→これによりゲストユーザーを使用して対象のsmbサーバーにアクセスしようとし、smbセキュリティレベルの情報を受け取る
6) nmapスクリプトを使用して、SMB共有経由でシステムにログインしているユーザを列挙する
nmap -p445 --script smb-enum-sessions ドメイン名
7) SMB認証情報を使用してnmapでターゲットをスキャンして、機密情報を検出する。
nmap -p445 --script smb-enum-sessions --script-args smbusername-administrator=smbserver_771 ドメイン名
8) 以下のコマンドを使用して、利用可能なすべての共有を列挙する。
nmap -p445 --script smb-enum-shares ドメイン名
9) 以下のコマンドで有効な資格情報を使用してすべての共有をスキャンし、権限を確認する。
nmap -p445 --script smb-enum-shares --script-args smbusername=administrator,smbpassword=smbserver_771 ドメイン名
10) 以下のコマンドを使用して、ターゲットマシン上のWindowsユーザーを列挙する。
nmap -p445 --script smb-enum-user --script-args smbusername=administrator,smbpassword=smbserver_771 ドメイン名
11) 以下のコマンドを使用して、サーバーの統計情報を取得する。
nmap -p445 --script smb-server-stats --script-args smbusername=administrator,smbpassword=smbserver_771 ドメイン名
12) 以下のコマンドを使用して、ターゲットマシン上で使用可能なドメインを列挙する。
nmap -p445 --script smb-enum-domains --script-args smbusername=administrator,smbpassword=smbserver_771 ドメイン名
13) 以下のコマンドを使用して、ターゲットマシン上で使用可能なユーザーグループを列挙する。
nmap -p445 --script smb-enum-groups --script-args smbusername=administrator,smbpassword=smbserver_771 ドメイン名
14) 以下のコマンドを使用して、ターゲットマシン上のサービスを列挙する。
nmap -p445 --script smb-enum-services --script-args smbusername=administrator,smbpassword=smbserver_771 ドメイン名
15) 以下のコマンドを使用して、すべての共有フォルダとドライブを列挙して、すべての共有フォルダーに対してlsコマンドを実行する。
nmap -p445 --script smb-enum-shares,smb-ls --script-args smbusername=administrator,smbpassword=smbserver_771 ドメイン名

task 利用可能なすべての生きているhostを検出する。
ここでは、まず
1) ターミナルを起動する
2) ifconfigでIPアドレスを取得する。
3) その後GUI環境でZenmapを起動
4) 2)で取得したIPアドレスをZenmapに入力してトポロジーで可視化







