脆弱性
windowsの脆弱性の概要
・基本的に古いOSのバージョンが残っていると、それが脆弱性になる。
・開発モデルと哲学を考慮すると、すべてのWindowsのOSはは類似性を有している。
例えば）
　１）windows OSは、C言語で開発されているため、バッファーオーバーフローや任意のコードの実行の脆弱性がある。
　2) デフォルトでは、Windowsは安全に実行するように構成されていないため、Windowsを安全に実行するように構成するには、セキュリティ対策の予防的な措置が必要
　3) 新たに発見された脆弱性は、マイクロソフトに直ぐには、修正されず、Windowsの断片化された性質を考えると多くのシステムは修正されないまま残される。

・Windowsの最大の問題点は、断片化である

・Windowsの新バージョンが頻繁にリリースされることも悪用される要因の1つ。
・Windowsは、固有の脆弱性に加えて、sqlインジェクション攻撃などのクロスクロスプラットフォームの脆弱性にも脆弱
・Windowsを実行してシステムやホストは、盗難,悪意のある周辺機器などの物理的な攻撃に対しても脆弱。

・Windowsにおける脆弱性の種類
1) 情報開示：攻撃者が機密データにアクセスできるようにする脆弱性
2) バッファーオーバーフロー：プログラミングエラーによって発生し、攻撃者がバッファーに書き込み、割り当てられたバッファーをオーバーランさせ、結果として割り当てられたメモリアドレスにデータを書き込むことを可能にした。
3) リモートコードの実行：脆弱性により、攻撃者がリモートから標的にシステム上でコードを実行できる。
4) 権限昇格：脆弱性により、攻撃者はシステムの初期攻撃後に権限を昇格することができる。
5) サービス拒否(DOS)：脆弱性により攻撃者は、システムやホストのリソースを消費し、結果としてシステムが正常に機能しなくなる可能性がある。

quiz
・悪意のあるコードの実行に直接関係しないものはバッファーフロー

頻繁に悪用されるwindowsサービス
・Windowsには、ホスト上で実行するように構成できる様々なネイティブサービスとプロトコルがある。
・これらのサービスは、攻撃者にターゲットホストへのアクセスに利用できるアクセスベクトルを提供する。
・これらのサービスがどのようなものか、どのように機能するか、潜在的な脆弱性をがあるのかを十分に理解することは、侵入テスターとして持つべき非常に重要なスキルである。

・よく悪用されるWindowsサービス
protocol/service		    port		                    purpose				
Microsoft IIS		        TCP ports 80/443			　Microsoftが開発したWindows上で動作する独自のWebサーバーソフトウェア
インターネット情報サービス								  SSLが構成されている場合TCP80または443で実行されるネイティブWindowsサービスはIIS
WebDAV　　　　　　　　　　　　TCP port 80/443               クライアントがWebサーバー上のファイルを更新、削除、移動、コピーできるようにするHTTP拡張機能
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　WebDAVはWebサーバーをファイルサーバーとして機能させるために使用される。
SMB/CIFS                    TCP port 445                  ローカルネットワーク内のコンピュータ間でファイルや周辺機器を共有するために使用されるネットワークファイルの共有プロトコル
RDP                         TCP port 3389                 Microsoftが開発した独自のGUIリモートアクセスプロトコル
　　　　　　　　　　　　　　　                               Windowsシステムにリモートで認証・操作するために使用される。
                                                          WindowsシステムでRDPサービスはデフォルトでは有効になっていない
WinRM                       TCP port 5986/443             Windowsシステムへのリモートアクセスを容易にするために使用されるWindowsリモート管理プロトコル


Metasploitフレームワークを使用した脆弱性スキャン
・脆弱性スキャニングと検出は、対象をスキャンして脆弱性を確認して、それらが悪用可能かどうかを検証するプロセス。
・このセクションでは、補助モジュールやエクスプロイトモジュールを活用し、サービス、OS、Webアプリケーションに内在する脆弱性をスキャンして特定するプロセスを探る
→この情報は、攻撃フェーズに役立つ。

・プロセス
1) sudo nmap -sn IP address/subnet
2) ip a s
3) msfconsole
4) db_status
5) setg RHOSTS IP address
6) setg RHOST IP address
7) workspace -a name
8) db_nmap -sS -sV -O IP address
9) hosts
10) services
11) search type:exploit name:Microsoft IIS
12) search type:exploit name:MySQL 5.5
13) search service name
14) use directory
15) info
16) 

Linuxにおける脆弱性
・Linuxは無料でオープンソースのOSであり、LinuxカーネルとGNUツールキットで構成されている。
→このオープンソースソフトウェアの組み合わせが全体としてLinuxOSを形成しており、一般的に、GNU/Linuxと呼ばれる。
＊カーネル：OSの中心的なプログラムでハードウェアのリソースを管理し、アプリケーションの実行許可して、これらを仲介する。
・Linuxは、サーバー用のOSとして利用される。

・Linuxサービスでよく攻撃される例
プロトコル/サービス       port                     目的
apache/web server    tcp port 80/443     　　apache license 2.0の下で公開されている無料かつオープンソースのクロスプラットフォームウェブサーバ
　　　　　　　　　　　　　　　　　　　　　　　　 世界のウェブサーバーの80％以上がapacheを使用　
ssh                  tcp port 22             sshは暗号化されたリモートアクセスプロトコルで、セキュアではないネットワーク越しにシステムへのリモートアクセス・制御されるために利用される。
ftp                  tcp port 21             FTPはtcp port21を使用するプロトコルでサーバーとクライアント間またはクライアント同士間のファイル共有を容易にする。
SAMBA                tcp port 445            sambaはsmbのLinuxの実装で、WindowsシステムがLinux共有フォルダやデバイスへのアクセスを可能にする。

脆弱性の分析：Shell shock
・Shellshock（CVE-2014-6271）は、Bashシェルに存在する一連の脆弱性につけられた名前である。
これにより攻撃者は、Bashを通じて任意のリモートコマンドを実行でき、その結果リバースジェルを用いてターゲットシステムへのリモートアクセスを取得できる。
・Bashは、GNUプロジェクトの一部であるＵＮＩＸ系シェルであり、ほとんどのＬｉｎｕｘディストリビューションでデフォルトのシェルとして設定されている。

・shellshockの脆弱性は、Bashの欠陥によって発生する
→具体的には、Bashが（）｛；：｝；という文字列の後に続くコマンドを誤って実行してしまうことに起因する
・Windowsには、Ｂａｓｈを利用していないので、この脆弱性はLinuxのみに影響する
・CGIスクリプトは、ApacheによってLinuxシステム上で任意のコマンドで実行するために使われ、その結果がクライアントに返される。この仕組みが攻撃に利用できる。


・shellshockの脆弱性を悪用するには、bashでやり取りできる入力ベクトルやスクリプトを特定する必要がある。
・apacheウェブサーバーの文脈では、Ｗｅｂサーバー上でアクセス可能な正当なcgi scriptを利用できる。
→cgiスクリプトが実行されると、ウェブサーバーは新しいプロセスを起動し、そのcgiスクリプトをbashで実行する。
・この脆弱性は、手動でもmsfの攻撃モジュールを使っても自動的に悪用できる可能性がある。


デモンストレーション
1) terminalを起動する
2) ifconfigでIPを取得
3) nmap -sV IP address
4) IP addressをブラウザで検索
5) IP address/javascriptで得たもの
6) nmap -sV IP --script=http-shellshock --script-args "http-shellshock.uri=/gettime.cgi"
7) burp起動
8) nc -nvlp 1234
9) service postgresql start && msfconsole
10) search shellshock
11) use exploit module
12) show options 
13) foxpoxsyからIPアドレスの取得
14) set RHOSTS 13)で取得したIP
15) set TARGET /gettime.cgi
16)exploit
17) sysinfo

quiz
・shellshockの脆弱性を悪用するために一般的に変更されるHTTPヘッダーフィールドはユーザーエージェント
・shellshockの脆弱性によってリモートでの任意のコマンドの実行が可能
・shellshockの脆弱性につながるBashの特性は、具体的には、環境変数関数の宣言に誤りがある。
・shellshockの脆弱性をはっけんしたのは、ステファン・シャゼラスでは、2014年9月に公開した。

								
