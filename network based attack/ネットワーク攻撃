ネットワーク列挙
・ペンテスにおいて、ホストの発見とポートスキャンが行った後に、次の論理的なステップはサービスの列挙になる
・サービスの列挙の目的はネットワーク上のホストやシステム、およびそれらで動作しているサービスに関する、より詳細で具体的な情報を収集すること
・これには、アカウント名、共有情報、設定ミスのあるサービスなどの情報が含まれる
・スキャン段階と同様に列挙も対象ホストやサービスへのアクティブな接続が伴う

・ネットワークシステム上には、多くのプロトコルが存在しており、それらが誤って設定されていたり、有効のまま放置されている場合m、攻撃者は、それらを標的にすることができる

SMB&NetBios列挙
・SMBとNetbiosは、Windows上のネットワーク上でのネットワーキングやファイル共有という文脈では関係している。

・Netbiosは、ローカルネットワーク上で通信サービスを提供するためのAPIおよびネットワークプロトコル群
主に異なるコンピュータ上のアプリケーションがネットワーク上でお互いにを見つけてやり取りするために使用される
・機能：netbiosは主に3つの基本的なサービスを提供する
1) Name Service：コンピュータがローカルネットワーク内で名前を登録、解除する、解決できるようにする
2) Dtagram Service：接続レス通信およびブロードキャスト通信をサポートする
3) Session Service：接続指向の通信をサポートし、より信頼性の高いデータ転送を実現する。
・ポート番号は、137,138,139を使用する。

・SMBは、ネットワーク上のコンピュータ同士がファイル、プリンタ、その他のリソースを共有できるようにするネットワークファイル共有プロトコル
・機能としては、ファイル共有、プリンタ共有、名前付きパイプ、プロセス間通信などを提供する。
これによりユーザはリモートコンピュータ上のファイルをローカルのように扱える
・バージョンは以下の3つがある
1) SMB 1.0：初期バージョンでセキュリティ上の脆弱性がある。windowsXPなど古いOSで使用される
2) SMB 2.0/2.1：WindowsVista/windows Server 2008で導入。性能とセキュリティが改善された
3) SMB 3.0以降：Windows 8/windows server 2012で導入。暗号化、マルチチャネル通信、仮想化向けの改善などを追加
・ポート番号は。通常は、445 を使用するが、netbios経由の場合は139を使用する。

・現在のネットワークでは、SMBをファイル共有やプリンタの共有に利用されていて、名前解決には、Netbiosの代わりにDNSなどの仕組みが使用される
・現在のWindowsでは、主にsmbを使用しており、netbiosなしでも動作可能
ただし、後方互換性のためにTCPポート139上のNetbiosが必要になる場合がある。

SNMP列挙
・SNMPは、ルータ・スイッチ・プリンタ・サーバなどネットワーク機器の監視および管理に広く使用されるプロトコル
・SNMPを利用するとネットワーク管理者は、デバイスの状態情報を問い合わせたり、特定の設定を構成したり特定のイベントが発生した際にアラートやトラップを受け取ることができる。

・SNMPはアプリケーションのプロトコルであり、通常はUDPをトランスポート層として使用する
このプロトコルには、3つの主要な構成要素がある
1) SNMPマネージャ：ネットワーク上のデバイスに存在するSNMPエージェントへの問い合わせや通信を行うシステム
2) SNMPエージェント：ネットワーク機器上で動作するソフトウェアで、SNMPクエリに応答したり、トラップを送信したりする
3) MIB（管理情報ベース）：SNMPを通じて利用可能なデータの構造を定義する階層型データベース
　　　　　　　　　　　　　各データ項目にはOIDという固有のIDが割り当てられる

・SNMPには以下の3つのバージョンがある
1) SNMPv1：最も初期のバージョンで、コミュニティ文字列を使って認証する
2) SNMPv2c：データの一括転送に対応した改良版だが、依然としてコミュニティ文字列に依存している
3) SNMPv3：暗号化、メッセージの完全性検証、ユーザベースの認証など、セキュリティ機能が導入された最新バージョン

・使用ポートは、
161：SNMPクエリ用
162：SNMPトラップ用

・SNMP列挙とは、ペンテスにおいて、SNMPが有効化されているデバイスに対してクエリを送り、脆弱性、設定ミス、攻撃可能なポイントを特定するための有用な情報を収集するプロセス

・ペンテス中におけるSNMP列挙の主な目的と成果
1) SNMPが有効なデバイスの特定：ネットワーク上でどのデバイスがSNMPを有効にしているかを判定し、情報漏洩や攻撃に対して脆弱かどうかを確認
2) システム情報の抽出：デバイス名、OS、ソフトウェアのバージョン、ネットワークインターフェースなどのシステム関連データを収集する
3) SNMPコミュニティストリングの特定：デフォルトや弱いコミュニティストリングを検査し、それにより不正な情報へアクセスできないか確認する
4) ネットワーク設定の取得：ルーティングテーブルやネットワークインターフェース、IPアドレスなどネットワーク固有の情報を収集する
5) ユーザ/グループ情報の収集：場合によっては、SNMP経由でユーザアカウントやアクセス権限などが取得できる
6) サービスやアプリケーションの特定：ターゲット上で動作しているサービスやアプリを把握し、さらなる攻撃経路になり得箇所を見つける。


SMBリレー攻撃
・SMBリレー攻撃とは、攻撃者がSMBトラフィックを傍受して改変し、それを正規のサーバ中継することで、不正にリソースへアクセスしたり悪意のある操作を実行するタイプのネットワーク攻撃
・発生しやすい環境：この種の攻撃は、ファイル共有やプリンター共有などでSMBを使うWindowsネットワークでよく見られる

・リレー攻撃の仕組みは以下のようになる
1) 盗聴
攻撃者はクライアントとサーバ間の中間者のいちに確立する。
これは、ARPスプーフィングmDNSポイズニングまたは不正なSMBサーバの設置などさまざまな手法で行われる
2) 認証情報の取得
クライアントが正規のサーバへSMB接続を行うとき、認証データが送信される。
攻撃者はこのデータを傍受する
3) 正規サーバーへの中継
傍受したNTLMハッシュを解読する代わりに、攻撃者はそれを送信元を信頼する別のサーバへ中継する
これにより攻撃者はハッシュが傍受されたユーザになりすます
4) アクセス獲得
中継が成功すると攻撃者は、サーバ上のリソースへのアクセスが得られる。このアクセスによりネットワーク内部での横展開が発生しさらに多くのシステムが侵害される可能性がある。
